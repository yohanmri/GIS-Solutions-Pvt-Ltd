import React, { useState, useEffect } from 'react';
import { useNavigate, useLocation } from 'react-router-dom';
import usePermissions from '../../hooks/usePermissions';
import '@esri/calcite-components/components/calcite-shell-panel';
import '@esri/calcite-components/components/calcite-action-bar';
import '@esri/calcite-components/components/calcite-action';
import '@esri/calcite-components/components/calcite-action-group';
import '@esri/calcite-components/components/calcite-panel';
import '@esri/calcite-components/components/calcite-icon';

export default function AdminSidebar() {
  const navigate = useNavigate();
  const location = useLocation();
  const { hasPermission, isSuperAdmin } = usePermissions();
  const [activePanel, setActivePanel] = useState('dashboard');

  const handleNavigation = (path) => {
    navigate(path);
  };

  useEffect(() => {
    if (location.pathname.includes('/admin/services')) {
      setActivePanel('services');
    } else if (location.pathname.includes('/admin/notifications')) {
      setActivePanel('dashboard');
    } else if (
      location.pathname.includes('/admin/dashboard') ||
      location.pathname.includes('/admin/recent-activity') ||
      location.pathname.includes('/admin/contact-view')
    ) {
      setActivePanel('dashboard');
    }
  }, [location.pathname]);

  const listItemStyle = {
    padding: '12px 16px',
    cursor: 'pointer',
    borderBottom: '1px solid var(--calcite-ui-border-3)',
    transition: 'background-color 0.15s ease',
  };

  const listItemHoverStyle = {
    backgroundColor: 'var(--calcite-ui-foreground-2)',
  };

  const groupHeadingStyle = {
    padding: '12px 16px 8px',
    fontSize: '12px',
    fontWeight: '600',
    color: 'var(--calcite-ui-text-3)',
    textTransform: 'uppercase',
    letterSpacing: '0.5px',
  };

  const ListItem = ({ icon, label, description, onClick }) => {
    const [isHovered, setIsHovered] = useState(false);

    return (
      <div
        style={{
          ...listItemStyle,
          ...(isHovered ? listItemHoverStyle : {}),
        }}
        onMouseEnter={() => setIsHovered(true)}
        onMouseLeave={() => setIsHovered(false)}
        onClick={onClick}
      >
        <div style={{ display: 'flex', alignItems: 'start', gap: '12px' }}>
          <calcite-icon icon={icon} scale="s" style={{ marginTop: '2px' }}></calcite-icon>
          <div style={{ flex: 1 }}>
            <div style={{ fontWeight: '500', marginBottom: '2px', fontSize: '14px' }}>
              {label}
            </div>
            <div style={{ fontSize: '12px', color: 'var(--calcite-ui-text-3)' }}>
              {description}
            </div>
          </div>
        </div>
      </div>
    );
  };

  return (
    <calcite-shell-panel slot="panel-start" position="start" displayed>
      <calcite-action-bar slot="action-bar">
        <calcite-action-group>
          <calcite-action
            text="Dashboard"
            icon="dashboard"
            active={activePanel === 'dashboard'}
            onClick={() => {
              setActivePanel('dashboard');
              handleNavigation('/admin/dashboard');
            }}
          ></calcite-action>

          <calcite-action
            text="Services"
            icon="layers"
            active={activePanel === 'services'}
            onClick={() => setActivePanel('services')}
          ></calcite-action>
        </calcite-action-group>

        <calcite-action-group slot="actions-end">
          <calcite-action
            text="Settings"
            icon="gear"
            onClick={() => handleNavigation('/admin/settings')}
          ></calcite-action>
        </calcite-action-group>
      </calcite-action-bar>

      {/* Dashboard Panel */}
      <calcite-panel
        heading="Dashboard"
        description="Overview and statistics"
        hidden={activePanel !== 'dashboard'}
      >
        <div>
          <ListItem
            icon="dashboard"
            label="Overview"
            description="Quick stats and cards"
            onClick={() => handleNavigation('/admin/dashboard')}
          />
          <ListItem
            icon="clock"
            label="Recent Activity"
            description="Latest updates"
            onClick={() => handleNavigation('/admin/recent-activity')}
          />
          <ListItem
            icon="email-address"
            label="Contact View Page"
            description="Requests from page visitors"
            onClick={() => handleNavigation('/admin/contact-view')}
          />
        </div>
      </calcite-panel>

      {/* Services Panel */}
      <calcite-panel
        heading="Services"
        description="Manage services, training, and events"
        hidden={activePanel !== 'services'}
      >
        <div>
          {/* Professional Services */}
          <div style={groupHeadingStyle}>Professional Services</div>
          <ListItem
            icon="map"
            label="All Professional Services"
            description="View all professional services"
            onClick={() => handleNavigation('/admin/services/professional')}
          />
          <ListItem
            icon="plus-circle"
            label="Add Professional Service"
            description="Create new professional service"
            onClick={() => handleNavigation('/admin/services/professional/add')}
          />

          {/* Training Programs */}
          <div style={groupHeadingStyle}>Training Programs</div>
          <ListItem
            icon="book"
            label="All Training Programs"
            description="View all training programs"
            onClick={() => handleNavigation('/admin/services/training')}
          />
          <ListItem
            icon="plus-circle"
            label="Add Training Program"
            description="Create new training program"
            onClick={() => handleNavigation('/admin/services/training/add')}
          />

          {/* Events */}
          <div style={groupHeadingStyle}>Events</div>
          <ListItem
            icon="calendar"
            label="All Events"
            description="View all events"
            onClick={() => handleNavigation('/admin/services/events')}
          />
          <ListItem
            icon="plus-circle"
            label="Add Event"
            description="Create new event"
            onClick={() => handleNavigation('/admin/services/events/add')}
          />
        </div>
      </calcite-panel>
    </calcite-shell-panel>
  );
}


